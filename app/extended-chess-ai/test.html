<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extended Chess AI Test</title>
</head>
<body>
    <h1>Extended Chess AI Test</h1>
    <div id="output"></div>
    <button onclick="runTest()">Run AI Test</button>

    <script src="config.js"></script>
    <script src="ExtendedChessAI.js"></script>
    <script src="integration.js"></script>
    
    <script>
        function log(message) {
            const output = document.getElementById('output');
            output.innerHTML += message + '<br>';
            console.log(message);
        }

        // Mock game object for testing
        const mockGame = {
            board: Array(12).fill().map(() => Array(12).fill(null)),
            turn: 'white',
            
            setupBoard() {
                const offset = 2;
                
                // Black pieces (top)
                for (let col = 0; col < 8; col++) {
                    this.board[offset + 1][offset + col] = { type: 'pawn', color: 'black', hasMoved: false };
                }
                this.board[offset + 0][offset + 0] = { type: 'rook', color: 'black', hasMoved: false };
                this.board[offset + 0][offset + 7] = { type: 'rook', color: 'black', hasMoved: false };
                this.board[offset + 0][offset + 1] = { type: 'knight', color: 'black' };
                this.board[offset + 0][offset + 6] = { type: 'knight', color: 'black' };
                this.board[offset + 0][offset + 2] = { type: 'bishop', color: 'black' };
                this.board[offset + 0][offset + 5] = { type: 'bishop', color: 'black' };
                this.board[offset + 0][offset + 3] = { type: 'queen', color: 'black' };
                this.board[offset + 0][offset + 4] = { type: 'king', color: 'black', hasMoved: false };

                // White pieces (bottom)
                for (let col = 0; col < 8; col++) {
                    this.board[offset + 6][offset + col] = { type: 'pawn', color: 'white', hasMoved: false };
                }
                this.board[offset + 7][offset + 0] = { type: 'rook', color: 'white', hasMoved: false };
                this.board[offset + 7][offset + 7] = { type: 'rook', color: 'white', hasMoved: false };
                this.board[offset + 7][offset + 1] = { type: 'knight', color: 'white' };
                this.board[offset + 7][offset + 6] = { type: 'knight', color: 'white' };
                this.board[offset + 7][offset + 2] = { type: 'bishop', color: 'white' };
                this.board[offset + 7][offset + 5] = { type: 'bishop', color: 'white' };
                this.board[offset + 7][offset + 3] = { type: 'queen', color: 'white' };
                this.board[offset + 7][offset + 4] = { type: 'king', color: 'white', hasMoved: false };
            },

            calculatePossibleMoves(row, col) {
                // Simplified move generation for testing
                const moves = [];
                const piece = this.board[row][col];
                if (!piece) return moves;

                if (piece.type === 'pawn') {
                    const direction = piece.color === 'white' ? -1 : 1;
                    const newRow = row + direction;
                    if (newRow >= 2 && newRow <= 9 && !this.board[newRow][col]) {
                        moves.push([newRow, col]);
                        // Double move from starting position
                        if (!piece.hasMoved && !this.board[newRow + direction][col]) {
                            moves.push([newRow + direction, col]);
                        }
                    }
                }

                return moves;
            },

            isKingInCheck(color) {
                // Simplified check detection for testing
                return false;
            }
        };

        async function runTest() {
            log('Starting Extended Chess AI Test...');
            
            try {
                // Initialize AI
                const ai = new ExtendedChessAIIntegration();
                log('✓ AI initialized successfully');

                // Setup board
                mockGame.setupBoard();
                log('✓ Test board setup complete');

                // Test AI move generation
                log('Testing AI move generation...');
                const move = await ai.makeAIMove(mockGame, 'white', 2);
                
                if (move) {
                    log('✓ AI generated move: ' + ai.moveToString(move));
                    log('  From: ' + move.from.r + ',' + move.from.c);
                    log('  To: ' + move.to.r + ',' + move.to.c);
                } else {
                    log('✗ AI failed to generate a move');
                }

                // Test position evaluation
                const analysis = ai.analyzePosition(mockGame);
                log('✓ Position analysis complete');
                log('  Evaluation: ' + JSON.stringify(analysis.evaluation));
                log('  Game phase: ' + analysis.gamePhase);

                // Test top moves
                const topMoves = ai.getTopMoves(mockGame, 'white', 3);
                log('✓ Top moves analysis: ' + topMoves.length + ' moves found');

                log('All tests completed successfully!');

            } catch (error) {
                log('✗ Test failed: ' + error.message);
                console.error(error);
            }
        }
    </script>
</body>
</html>
